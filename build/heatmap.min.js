/*! heatmap.js - v0.1.0 - last build: 2013-12-04 05:44:35 */
(function(a){var b={defaultRadius:40,renderer:"canvas2d",gradientConfig:{.25:"rgb(0,0,255)",.35:"rgb(0,255,255)",.55:"rgb(0,255,0)",.85:"yellow",1:"rgb(255,0,0)"}};var c=function i(){var a=function d(){this._coordinator={};this._data=[];this._radi=[];this._min=0;this._max=1};var c=b.defaultRadius;a.prototype={_organiseData:function(a){var b=this._data;var d=this._radi;var e=this._max;var f=this._min;var g=+!!a.length;if(g===0){var h=[a];a=h;g=1}for(var i=0;i<g;i++){var j=a[i];var k=j.count;var l=j["radius"]||c;var m=j.x;var n=j.y;if(!b[m]){b[m]=[];d[m]=[]}if(!b[m][n]){b[m][n]=k||1;d[m][n]=l}else{b[m][n]+=k}if(b[m][n]>e){this.setDataMax(b[m][n])}else{this._coordinator.emit("renderpartial",{x:m,y:n,count:k,radius:l,min:f,max:e})}}},addData:function(){if(arguments[0].length>0){var a=arguments[0];var b=a.length;while(b--){this.addData.call(this,a[b])}}else{this._organiseData(arguments[0])}},setData:function(a){this._max=a.max;this._min=a.min||0;_organiseData(a);this._coordinator.emit("renderall",this.getData())},subtractData:function(){},setDataMax:function(a){this._max=a;this._coordinator.emit("renderall",this.getData())},setDataMin:function(a){this._min=a;this._coordinator.emit("renderall",this.getData())},setCoordinator:function(a){this._coordinator=a},getData:function(){return{max:this._max,min:this._min,data:this._data,radi:this._radi}}};return a}();var d=function j(){var a=function(a){var b=a.gradientConfig;var c=document.createElement("canvas");var d=c.getContext("2d");c.width=256;c.height=1;var e=d.createLinearGradient(0,0,256,1);for(var f in b){e.addColorStop(f,b[f])}d.fillStyle=e;d.fillRect(0,0,256,1);return d.getImageData(0,0,256,1).data};function b(b){var c=b.container;var d=document.createElement("canvas");var e=document.createElement("canvas");var f=getComputedStyle(b.container);this.width=e.width=d.width=+f.width.replace(/px/,"");this.height=e.height=d.height=+f.height.replace(/px/,"");this.shadowCtx=d.getContext("2d");this.ctx=e.getContext("2d");e.style.cssText=d.style.cssText="position:absolute;left:0;top:0;";c.style.position="relative";c.appendChild(e);this._palette=a(b)}var c=[1e3,1e3,0,0];b.prototype={renderPartial:function(a){this._drawAlpha(a,false)},renderAll:function(a){c=[1e3,1e3,0,0];this._drawAlpha(a,true)},_drawAlpha:function(a,b){var d=a.min;var e=a.max;if(a["data"]){for(var f in a.data){var g=a.data[f];for(var h in g){var i={x:f,y:h,min:d,max:e,radius:a.radi[f][h],count:g[h]};this._drawAlpha(i,true)}}this._colorize(c[0],c[1],c[2]-c[0],c[3]-c[1]);return}else{var j=a.x;var k=a.y;var l=a.radius;var m=a.count;var n=j-l;var o=k-l;var p=this.shadowCtx.createRadialGradient(j,k,l/3.12,j,k,l);p.addColorStop(0,["rgba(0,0,0, ",(Math.abs(e-d)/m*100>>0)/100,")"].join(""));p.addColorStop(1,"rgba(0,0,0,0)");this.shadowCtx.fillStyle=p;this.shadowCtx.fillRect(n,o,l*2,l*2);if(!b){this._colorize(n,o,a["radius"]*2,a["radius"]*2)}else{if(n<c[0]){c[0]=n}if(o<c[1]){c[1]=o}if(n+2*l>c[2]){c[2]=n+2*l}if(o+2*l>c[3]){c[3]=o+2*l}}}},_colorize:function(a,b,c,d){var e=this.width;var f=this.height;if(a<0){a=0}if(b<0){b=0}if(a+c>e){c=e-a}if(b+d>f){d=f-b}var g=this.shadowCtx.getImageData(a,b,c,d);var h=g.data;var i=h.length;var j=this._palette;for(var k=3;k<i;k+=4){var l=h[k];var m=l*4;if(!m){continue}h[k-3]=j[m];h[k-2]=j[m+1];h[k-1]=j[m+2];h[k]=255}g.data=h;this.ctx.putImageData(g,a,b)}};return b}();var e=function k(){var a=false;if(b["renderer"]==="canvas2d"){a=d}return a}();var f={merge:function(){var a={};var b=arguments.length;for(var c=0;c<b;c++){var d=arguments[c];for(var e in d){a[e]=d[e]}}return a}};var g=function l(){var a=function h(){function a(){this.cStore={}}a.prototype={on:function(a,b,c){var d=this.cStore;if(!d[a]){d[a]=[]}d[a].push(function(a){return b.call(c,a)})},emit:function(a,b){var c=this.cStore;if(c[a]){var d=c[a].length;for(var e=0;e<d;e++){var f=c[a][e];f(b)}}}};return a}();var d=function(a){var b=a._renderer;var c=a._coordinator;var d=a._store;c.on("renderpartial",b.renderPartial,b);c.on("renderall",b.renderAll,b);d.setCoordinator(c)};function g(){var g=f.merge(b,arguments[0]||{});this._coordinator=new a;this._renderer=new e(g);this._store=new c(g);d(this)}g.prototype={addData:function(){this._store.addData.apply(this._store,arguments)},subtractData:function(){this._store.subtractData.apply(this._store,arguments)},setData:function(){this._store.setData.apply(this._store,arguments)},setDataMax:function(){this._store.setDataMax.apply(this._store,arguments)},setDataMin:function(){this._store.setDataMin.apply(this._store,arguments)}};return g}();var h={create:function(a){return new g(a)}};a["h337"]=h})(this||window);