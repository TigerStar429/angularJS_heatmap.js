/*! heatmap.js - v0.1.0 - last build: 2013-12-04 15:52:31 */
(function(a){var b={defaultRadius:40,defaultRenderer:"canvas2d",defaultGradient:{.25:"rgb(0,0,255)",.35:"rgb(0,255,255)",.55:"rgb(0,255,0)",.85:"yellow",1:"rgb(255,0,0)"},defaultMaxOpacity:1};var c=function i(){var a=function d(){this._coordinator={};this._data=[];this._radi=[];this._min=0;this._max=1};var c=b.defaultRadius;a.prototype={_organiseData:function(a){var b=a["x"];var d=a["y"];var e=this._radi;var f=this._data;var g=this._max;var h=this._min;var i=a.count;var j=a.radius||c;if(!f[b]){f[b]=[];e[b]=[]}if(!f[b][d]){f[b][d]=i||1;e[b][d]=j}else{f[b][d]+=i}if(f[b][d]>g){this.setDataMax(f[b][d]);return false}else{return{x:b,y:d,count:i,radius:j,min:h,max:g}}},addData:function(){if(arguments[0].length>0){var a=arguments[0];var b=a.length;while(b--){this.addData.call(this,a[b])}}else{var c=this._organiseData(arguments[0]);if(c){this._coordinator.emit("renderpartial",c)}}},setData:function(a){var b=a.data;var c=b.length;this._max=a.max;this._min=a.min||0;this._data=[];this._radi=[];for(var d=0;d<c;d++){this._organiseData(b[d])}this._coordinator.emit("renderall",this._getInternalData())},subtractData:function(){},setDataMax:function(a){this._max=a;this._coordinator.emit("renderall",this._getInternalData())},setDataMin:function(a){this._min=a;this._coordinator.emit("renderall",this._getInternalData())},setCoordinator:function(a){this._coordinator=a},_getInternalData:function(){return{max:this._max,min:this._min,data:this._data,radi:this._radi}}};return a}();var d=function j(){var a=function(a){var b=a.gradientConfig||a.defaultGradient;var c=document.createElement("canvas");var d=c.getContext("2d");c.width=256;c.height=1;var e=d.createLinearGradient(0,0,256,1);for(var f in b){e.addColorStop(f,b[f])}d.fillStyle=e;d.fillRect(0,0,256,1);return d.getImageData(0,0,256,1).data};function b(b){var c=b.container;var d=document.createElement("canvas");var e=document.createElement("canvas");var f=getComputedStyle(b.container);this._width=e.width=d.width=+f.width.replace(/px/,"");this._height=e.height=d.height=+f.height.replace(/px/,"");this.shadowCtx=d.getContext("2d");this.ctx=e.getContext("2d");e.style.cssText=d.style.cssText="position:absolute;left:0;top:0;";c.style.position="relative";c.appendChild(e);this._palette=a(b);this._opacity=(b.opacity||0)*255;this._maxOpacity=(b.maxOpacity||b.defaultMaxOpacity)*255}var c=[1e3,1e3,0,0];b.prototype={renderPartial:function(a){this._drawAlpha(a,false)},renderAll:function(a){c=[1e3,1e3,0,0];this._clear();this._drawAlpha(a,true)},_clear:function(){this.shadowCtx.clearRect(0,0,this._width,this._height)},_drawAlpha:function(a,b){var d=a.min;var e=a.max;if(a["data"]){for(var f in a.data){var g=a.data[f];for(var h in g){var i={x:f,y:h,min:d,max:e,radius:a.radi[f][h],count:g[h]};this._drawAlpha(i,true)}}this._colorize(c[0],c[1],c[2]-c[0],c[3]-c[1]);return}else{var j=a.x;var k=a.y;var l=a.radius;var m=a.count;var n=j-l;var o=k-l;var p=this.shadowCtx.createRadialGradient(j,k,l/8,j,k,l);p.addColorStop(0,["rgba(0,0,0, ",m/Math.abs(e-d),")"].join(""));p.addColorStop(1,"rgba(0,0,0,0)");this.shadowCtx.fillStyle=p;this.shadowCtx.fillRect(n,o,l*2,l*2);if(!b){this._colorize(n,o,a["radius"]*2,a["radius"]*2)}else{if(n<c[0]){c[0]=n}if(o<c[1]){c[1]=o}if(n+2*l>c[2]){c[2]=n+2*l}if(o+2*l>c[3]){c[3]=o+2*l}}}},_colorize:function(a,b,c,d){var e=this._width;var f=this._height;var g=this._opacity;var h=this._maxOpacity;if(a<0){a=0}if(b<0){b=0}if(a+c>e){c=e-a}if(b+d>f){d=f-b}var i=this.shadowCtx.getImageData(a,b,c,d);var j=i.data;var k=j.length;var l=this._palette;for(var m=3;m<k;m+=4){var n=j[m];var o=n*4;if(!o){continue}var p;if(g>0){p=g}else{if(n<h){p=n}else{p=h}}j[m-3]=l[o];j[m-2]=l[o+1];j[m-1]=l[o+2];j[m]=p}i.data=j;this.ctx.putImageData(i,a,b)}};return b}();var e=function k(){var a=false;if(b["defaultRenderer"]==="canvas2d"){a=d}return a}();var f={merge:function(){var a={};var b=arguments.length;for(var c=0;c<b;c++){var d=arguments[c];for(var e in d){a[e]=d[e]}}return a}};var g=function l(){var a=function h(){function a(){this.cStore={}}a.prototype={on:function(a,b,c){var d=this.cStore;if(!d[a]){d[a]=[]}d[a].push(function(a){return b.call(c,a)})},emit:function(a,b){var c=this.cStore;if(c[a]){var d=c[a].length;for(var e=0;e<d;e++){var f=c[a][e];f(b)}}}};return a}();var d=function(a){var b=a._renderer;var c=a._coordinator;var d=a._store;c.on("renderpartial",b.renderPartial,b);c.on("renderall",b.renderAll,b);d.setCoordinator(c)};function g(){var g=f.merge(b,arguments[0]||{});this._coordinator=new a;this._renderer=new e(g);this._store=new c(g);d(this)}g.prototype={addData:function(){this._store.addData.apply(this._store,arguments)},subtractData:function(){this._store.subtractData.apply(this._store,arguments)},setData:function(){this._store.setData.apply(this._store,arguments)},setDataMax:function(){this._store.setDataMax.apply(this._store,arguments)},setDataMin:function(){this._store.setDataMin.apply(this._store,arguments)}};return g}();var h={create:function(a){return new g(a)}};a["h337"]=h})(this||window);