/*! heatmap.js - v0.1.0 - last build: 2014-02-14 11:36:54 */
(function(a){var b={defaultRadius:40,defaultRenderer:"canvas2d",defaultGradient:{.25:"rgb(0,0,255)",.55:"rgb(0,255,0)",.85:"yellow",1:"rgb(255,0,0)"},defaultMaxOpacity:1};var c=function i(){var a=function d(){this._coordinator={};this._data=[];this._radi=[];this._min=0;this._max=1};var c=b.defaultRadius;a.prototype={_organiseData:function(a){var b=a["x"];var d=a["y"];var e=this._radi;var f=this._data;var g=this._max;var h=this._min;var i=a.count;var j=a.radius||c;if(!f[b]){f[b]=[];e[b]=[]}if(!f[b][d]){f[b][d]=i||1;e[b][d]=j}else{f[b][d]+=i}if(f[b][d]>g){this.setDataMax(f[b][d]);return false}else{return{x:b,y:d,count:i,radius:j,min:h,max:g}}},addData:function(){if(arguments[0].length>0){var a=arguments[0];var b=a.length;while(b--){this.addData.call(this,a[b])}}else{var c=this._organiseData(arguments[0]);if(c){this._coordinator.emit("renderpartial",{min:this._min,max:this._max,data:[c]})}}return this},setData:function(a){var b=a.data;var c=b.length;this._max=a.max;this._min=a.min||0;this._data=[];this._radi=[];for(var d=0;d<c;d++){this._organiseData(b[d])}this._coordinator.emit("renderall",this._getInternalData());return this},subtractData:function(){},setDataMax:function(a){this._max=a;this._coordinator.emit("renderall",this._getInternalData());return this},setDataMin:function(a){this._min=a;this._coordinator.emit("renderall",this._getInternalData());return this},setCoordinator:function(a){this._coordinator=a},_getInternalData:function(){return{max:this._max,min:this._min,data:this._data,radi:this._radi}}};return a}();var d=function j(){var a=function(a){var b=a.gradientConfig||a.defaultGradient;var c=document.createElement("canvas");var d=c.getContext("2d");c.width=256;c.height=1;var e=d.createLinearGradient(0,0,256,1);for(var f in b){e.addColorStop(f,b[f])}d.fillStyle=e;d.fillRect(0,0,256,1);return d.getImageData(0,0,256,1).data};var b=function(a,b){var c=document.createElement("canvas");var d=c.getContext("2d");var b=b||50;var e=a+b;var f=a+b;c.width=c.height=a*2+b*2;d.shadowColor="black";d.shadowOffsetX=15e3;d.shadowOffsetY=15e3;d.shadowBlur=b;d.beginPath();d.arc(e-15e3,f-15e3,a,0,Math.PI*2,true);d.closePath();d.fill();return c};var c=function(a){var b=[];var c=a.min;var d=a.max;var e=a.radi;var a=a.data;var f=Object.keys(a);var g=f.length;while(g--){var h=f[g];var i=Object.keys(a[h]);var j=i.length;while(j--){var k=i[j];var l=a[h][k];var m=e[h][k];b.push({x:h,y:k,count:l,radius:m})}}return{min:c,max:d,data:b}};function d(b){var c=b.container;var d=document.createElement("canvas");var e=document.createElement("canvas");var f=this._renderBoundaries=[1e3,1e3,0,0];var g=getComputedStyle(b.container);this._width=e.width=d.width=+g.width.replace(/px/,"");this._height=e.height=d.height=+g.height.replace(/px/,"");this.shadowCtx=d.getContext("2d");this.ctx=e.getContext("2d");e.style.cssText=d.style.cssText="position:absolute;left:0;top:0;";c.style.position="relative";c.appendChild(e);this._palette=a(b);this._templates={};this._opacity=(b.opacity||0)*255;this._maxOpacity=(b.maxOpacity||b.defaultMaxOpacity)*255}d.prototype={renderPartial:function(a){this._drawAlpha(a);this._colorize()},renderAll:function(a){this._clear();this._drawAlpha(c(a));this._colorize()},updateGradient:function(b){this._palette=a(b)},_clear:function(){this.shadowCtx.clearRect(0,0,this._width,this._height)},_drawAlpha:function(a){var c=a.min;var d=a.max;var a=a.data||[];var e=a.length;while(e--){var f=a[e];var g=f.x;var h=f.y;var i=f.radius;var j=f.count;var k=15;var l=g-i-k;var m=h-i-k;var n=this.shadowCtx;if(i<k){k=i/1.5}var o;if(!this._templates[i]){this._templates[i]=o=b(i,k)}else{o=this._templates[i]}n.globalAlpha=j/Math.abs(d-c);n.drawImage(o,l,m);if(l<this._renderBoundaries[0]){this._renderBoundaries[0]=l}if(m<this._renderBoundaries[1]){this._renderBoundaries[1]=m}if(l+2*i>this._renderBoundaries[2]){this._renderBoundaries[2]=l+2*i+2*k}if(m+2*i>this._renderBoundaries[3]){this._renderBoundaries[3]=m+2*i+2*k}}},_colorize:function(){var a=this._renderBoundaries[0];var b=this._renderBoundaries[1];var c=this._renderBoundaries[2]-a;var d=this._renderBoundaries[3]-b;var e=this._width;var f=this._height;var g=this._opacity;var h=this._maxOpacity;if(a<0){a=0}if(b<0){b=0}if(a+c>e){c=e-a}if(b+d>f){d=f-b}var i=this.shadowCtx.getImageData(a,b,c,d);var j=i.data;var k=j.length;var l=this._palette;for(var m=3;m<k;m+=4){var n=j[m];var o=n*4;if(!o){continue}var p;if(g>0){p=g}else{if(n<h){p=n}else{p=h}}j[m-3]=l[o];j[m-2]=l[o+1];j[m-1]=l[o+2];j[m]=p}i.data=j;this.ctx.putImageData(i,a,b);this._renderBoundaries=[1e3,1e3,0,0]}};return d}();var e=function k(){var a=false;if(b["defaultRenderer"]==="canvas2d"){a=d}return a}();var f={merge:function(){var a={};var b=arguments.length;for(var c=0;c<b;c++){var d=arguments[c];for(var e in d){a[e]=d[e]}}return a}};var g=function l(){var a=function h(){function a(){this.cStore={}}a.prototype={on:function(a,b,c){var d=this.cStore;if(!d[a]){d[a]=[]}d[a].push(function(a){return b.call(c,a)})},emit:function(a,b){var c=this.cStore;if(c[a]){var d=c[a].length;for(var e=0;e<d;e++){var f=c[a][e];f(b)}}}};return a}();var d=function(a){var b=a._renderer;var c=a._coordinator;var d=a._store;c.on("renderpartial",b.renderPartial,b);c.on("renderall",b.renderAll,b);d.setCoordinator(c)};function g(){var g=this._config=f.merge(b,arguments[0]||{});this._coordinator=new a;this._renderer=new e(g);this._store=new c(g);d(this)}g.prototype={addData:function(){this._store.addData.apply(this._store,arguments);return this},subtractData:function(){this._store.subtractData.apply(this._store,arguments);return this},setData:function(){this._store.setData.apply(this._store,arguments);return this},setDataMax:function(){this._store.setDataMax.apply(this._store,arguments);return this},setDataMin:function(){this._store.setDataMin.apply(this._store,arguments);return this},configure:function(a){this._config=f.merge(this._config,a);if(a["gradientConfig"]){this._renderer.updateGradient(this._config)}return this},repaint:function(){this._coordinator.emit("renderall",this._store._getInternalData());return this}};return g}();var h={create:function(a){return new g(a)}};a["h337"]=h})(this||window);